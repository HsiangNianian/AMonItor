<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ollama Monitor Panel</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: Arial, sans-serif; margin: 16px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
      input, button, select { padding: 8px; }
      .card { border: 1px solid #6665; border-radius: 8px; padding: 12px; min-width: 180px; }
      .grid { display: grid; gap: 10px; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
      pre { border: 1px solid #6665; border-radius: 8px; padding: 10px; max-height: 260px; overflow: auto; }
      .ok { color: #10b981; }
      .warn { color: #f59e0b; }
      .err { color: #ef4444; }
    </style>
  </head>
  <body>
    <h2>Ollama 实时监控面板</h2>

    <div class="row">
      <input id="wsUrl" style="min-width:420px" value="ws://127.0.0.1:8080/ws/panel" />
      <input id="apiBaseUrl" style="min-width:320px" placeholder="API Base，例如 http://127.0.0.1:8011" />
      <button id="connectBtn">连接</button>
      <button id="disconnectBtn">断开</button>
      <span id="status" class="warn">未连接</span>
    </div>

    <div class="row">
      <select id="targetSelect">
        <option value="">选择目标服务（可选）</option>
      </select>
      <select id="actionName">
        <option value="reset_metrics">reset_metrics</option>
        <option value="set_max_concurrency">set_max_concurrency</option>
      </select>
      <input id="actionValue" placeholder="action value（例如 2）" />
      <input id="actionTargetId" placeholder="target_id（必填）" />
      <input id="actionTargetUrl" placeholder="target_url（必填）" style="min-width:320px" />
      <button id="sendActionBtn">发送 Action</button>
    </div>

    <div class="row" style="align-items: flex-start;">
      <textarea id="promptInput" placeholder="输入 prompt，例如：用一句话介绍 Qwen3:0.6B" style="min-width: 520px; min-height: 90px; padding: 8px;"></textarea>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <button id="generateBtn">调用 /api/generate</button>
        <small>将使用当前 WS 地址对应的同主机 API</small>
      </div>
    </div>

    <h3>模型输出</h3>
    <pre id="generateOutput"></pre>

    <div class="grid">
      <div class="card">Service：<b id="serviceName">-</b></div>
      <div class="card">Model：<b id="modelName">-</b></div>
      <div class="card">Token 字符总数：<b id="totalTokenChars">0</b></div>
      <div class="card">最近请求字符数：<b id="lastTokenChars">0</b></div>
      <div class="card">GPU 利用率：<b id="gpuUsage">-1%</b></div>
      <div class="card">排队数：<b id="queueSize">0</b></div>
      <div class="card">处理中：<b id="inProgress">0</b></div>
      <div class="card">总请求：<b id="totalReq">0</b></div>
      <div class="card">失败请求：<b id="failedReq">0</b></div>
    </div>

    <h3>事件日志</h3>
    <pre id="logBox"></pre>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
